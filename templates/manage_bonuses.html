<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrar Bonificaciones</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <h1>Administrar Bonificaciones</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes">
        {% for category, message in messages %}
          <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <div class="bonus-form"> {# <-- Mantén este div si tiene estilos de formulario general, pero sin 'table-responsive' #}
        <h2>Añadir Nueva Bonificación</h2>
        <form action="{{ url_for('manage_bonuses') }}" method="POST">
            <label for="queue_type">Tipo de Cola:</label>
            <select id="queue_type" name="queue_type" required>
                {% for queue in queues %}
                    <option value="{{ queue }}">{{ queue | capitalize }}</option>
                {% endfor %}
            </select>

            <label for="start_date">Fecha de Inicio:</label>
            <input type="date" id="start_date" name="start_date" required>

            <label for="start_time">Hora de Inicio (UTC):</label>
            <select id="start_time" name="start_time" required>
                {% for hour in range(24) %}
                    <option value="{{ '%02d' | format(hour) }}">{{ '%02d:00' | format(hour) }} UTC</option>
                {% endfor %}
            </select>
            <small>Seleccione la hora de inicio en formato UTC.</small>

            <label for="duration_hours">Duración (horas):</label>
            <input type="number" id="duration_hours" name="duration_hours" min="1" required>

            <button type="submit">Añadir Bonificación</button>
        </form>
    </div>

    <hr>

    <h2>Bonificaciones Existentes</h2>
    {% if bonuses %}
        <div class="table-responsive"> {# <--- CORRECTO: ESTE DIV ENVUELVE SOLO LA TABLA #}
            <table class="bonus-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Cola</th>
                        <th>Fecha Inicio</th>
                        <th>Hora Inicio</th>
                        <th>Duración (h)</th>
                        <th>Activa</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                {% for bonus in bonuses %}
                    <tr>
                        <td>{{ bonus.id }}</td>
                        <td>{{ bonus.queue_type | capitalize }}</td>
                        <td>{{ bonus.start_date }}</td>
                        <td>{{ bonus.start_time }}</td>
                        <td>{{ bonus.duration_hours }}</td>
                        <td>
                            <span class="{{ 'status-active' if bonus.active else 'status-inactive' }}">
                                {{ 'Sí' if bonus.active else 'No' }}
                            </span>
                        </td>
                        <td>
                            <form action="{{ url_for('toggle_bonus_active', bonus_id=bonus.id) }}" method="POST" style="display: inline;">
                                <button type="submit" class="toggle-btn" title="{{ 'Desactivar' if bonus.active else 'Activar' }}">
                                    {% if bonus.active %}
                                        <i class="fas fa-toggle-on"></i> {% else %}
                                        <i class="fas fa-toggle-off"></i> {% endif %}
                                </button>
                            </form>

                            <form action="{{ url_for('delete_bonus', bonus_id=bonus.id) }}" method="POST" style="display: inline;" onsubmit="return confirm('¿Estás seguro de que quieres eliminar esta bonificación?');">
                                <button type="submit" class="delete-btn" title="Eliminar Bonificación">
                                    <i class="fas fa-trash"></i> </button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div> {# <--- CIERRE CORRECTO DEL DIV #}
    {% else %}
        <p>No hay bonificaciones configuradas.</p>
    {% endif %}

    <div class="admin-return-buttons">
        <a href="{{ url_for('admin_panel') }}" class="nav-button">Volver al Panel de Administración</a>
        <a href="{{ url_for('index') }}" class="nav-button">Volver a la Página Principal</a>
    </div>

</body>
</html>