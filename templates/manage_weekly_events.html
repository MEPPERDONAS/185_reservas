<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Weekly Events</title>
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Manage Weekly Events</h1>
        <div class="admin-return-buttons">
            <a href="{{ url_for('admin_panel') }}" class="nav-button">&larr; Back to Admin Panel</a>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class="flashes">
                {% for category, message in messages %}
                <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
        {% endwith %}

        <div class="first-in-queue-container">
            <h2>Create a New Weekly Event</h2>
            <form action="{{ url_for('manage_weekly_events') }}" method="POST">
                <div class="form-group">
                    <label for="name">Event Name</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="start_date">Start Date</label>
                    <input type="date" id="start_date" name="start_date" required>
                </div>
                <div class="form-group">
                    <label for="end_date">End Date</label>
                    <input type="date" id="end_date" name="end_date" required>
                </div>
                <div class="form-group">
                    <label for="reminder_time">Reminder Time (UTC)</label>
                    <input type="time" id="reminder_time" name="reminder_time" required value="10:00">
                </div>

                <div class="weekly-days">
                    {% set days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'] %}
                    {% for day in days %}
                        <div class="form-group">
                            <label for="{{ day }}">{{ day|capitalize }}</label>
                            <input type="text" id="{{ day }}" name="{{ day }}" placeholder="Enter activity for {{ day }}" maxlength="100">
                        </div>
                    {% endfor %}
                </div>
                
                <button type="submit">Create Event</button>
            </form>
        </div>

        <div class="first-in-queue-container">
            <h2>Existing Weekly Events</h2>
            {% if events %}
                <ul class="queue-list">
                    {% for event in events %}
                    <li class="queue-item">
                        <div class="event-header">
                            <h3>{{ event.name }}</h3>
                            <p class="event-dates">From: {{ event.start_date.isoformat() }} to: {{ event.end_date.isoformat() }}</p>
                            <p class="event-time">Reminder Time: {{ event.reminder_time }} UTC</p>
                            <p class="event-status">Status: <span class="status-{{ 'active' if event.active else 'inactive' }}">{{ 'Active' if event.active else 'Inactive' }}</span></p>
                        </div>
                        <div class="event-actions">
                            <form action="{{ url_for('toggle_weekly_event_active', event_id=event.id) }}" method="POST">
                                <button type="submit" class="toggle-btn" title="{{ 'Deactivate' if event.active else 'Activate' }}">
                                    {% if event.active %}
                                        <i class="fas fa-toggle-on fa-lg"></i>
                                    {% else %}
                                        <i class="fas fa-toggle-off fa-lg"></i>
                                    {% endif %}
                                </button>
                            </form>
                            <form action="{{ url_for('delete_weekly_event', event_id=event.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this event?');">
                                <button type="submit" class="delete-btn" title="Delete">
                                    <i class="fas fa-trash-alt fa-lg"></i>
                                </button>
                            </form>
                        </div>
                        <div class="event-details">
                            <p><strong>Monday:</strong> {{ event.monday or 'No activity' }}</p>
                            <p><strong>Tuesday:</strong> {{ event.tuesday or 'No activity' }}</p>
                            <p><strong>Wednesday:</strong> {{ event.wednesday or 'No activity' }}</p>
                            <p><strong>Thursday:</strong> {{ event.thursday or 'No activity' }}</p>
                            <p><strong>Friday:</strong> {{ event.friday or 'No activity' }}</p>
                            <p><strong>Saturday:</strong> {{ event.saturday or 'No activity' }}</p>
                            <p><strong>Sunday:</strong> {{ event.sunday or 'No activity' }}</p>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No weekly events have been created yet.</p>
            {% endif %}
        </div>
    </div>
</body>
</html>